<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/comm.css">
    <link rel="stylesheet" href="./css/nav.css">
    <link rel="stylesheet" href="./css/shopping.css">
    <link rel="stylesheet" href="./font-awesome-4.7.0/css/font-awesome.min.css">

</head>

<body>

    <header>
        <nav>
            <div class="wrapper">
                <div class="head">
                    <ul class="mainNav">
                        <li>
                            <a href="">
                                <img src="./img/l-6.png" alt="">
                            </a>

                        </li>
                        <li>
                            <a href="index.html">
                                首页
                            </a>
                        </li>
                        <li>
                            <a href="">
                                全屋系列
                            </a>
                            <div class="inner_nav_bg">
                                <ul class="inner_nav">
                                    <li><a href="">全部</a></li>
                                    <li><a href="">城市丛林系列</a></li>
                                    <li><a href="">牙白香榭系列</a></li>
                                    <li><a href="">本木侘寂系列</a></li>
                                    <li><a href="">瑞典美术系列</a></li>
                                    <li><a href="">海盐硬糖系列</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="">
                                沙发·椅凳
                            </a>
                            <div class="inner_nav_bg">
                                <ul class="inner_nav">
                                    <li><a href="">全部</a></li>
                                    <li><a href="">城市丛林系列</a></li>
                                    <li><a href="">牙白香榭系列</a></li>
                                    <li><a href="">本木侘寂系列</a></li>
                                    <li><a href="">瑞典美术系列</a></li>
                                    <li><a href="">海盐硬糖系列</a></li>
                                </ul>
                            </div>
                        </li>

                        <li>
                            <a href="">
                                桌 | 几 | 台
                            </a>
                            <div class="inner_nav_bg">
                                <ul class="inner_nav">
                                    <li><a href="">全部</a></li>
                                    <li><a href="">城市丛林系列</a></li>
                                    <li><a href="">牙白香榭系列</a></li>
                                    <li><a href="">本木侘寂系列</a></li>
                                    <li><a href="">瑞典美术系列</a></li>
                                    <li><a href="">海盐硬糖系列</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="">
                                床·床具
                            </a>
                            <div class="inner_nav_bg">
                                <ul class="inner_nav">
                                    <li><a href="">全部</a></li>
                                    <li><a href="">城市丛林系列</a></li>
                                    <li><a href="">牙白香榭系列</a></li>
                                    <li><a href="">本木侘寂系列</a></li>
                                    <li><a href="">瑞典美术系列</a></li>
                                    <li><a href="">海盐硬糖系列</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="">
                                柜架
                            </a>
                            <div class="inner_nav_bg">
                                <ul class="inner_nav">
                                    <li><a href="">全部</a></li>
                                    <li><a href="">城市丛林系列</a></li>
                                    <li><a href="">牙白香榭系列</a></li>
                                    <li><a href="">本木侘寂系列</a></li>
                                    <li><a href="">瑞典美术系列</a></li>
                                    <li><a href="">海盐硬糖系列</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="">
                                灯具
                            </a>
                            <div class="inner_nav_bg">
                                <ul class="inner_nav">
                                    <li><a href="">全部</a></li>
                                    <li><a href="">城市丛林系列</a></li>
                                    <li><a href="">牙白香榭系列</a></li>
                                    <li><a href="">本木侘寂系列</a></li>
                                    <li><a href="">瑞典美术系列</a></li>
                                    <li><a href="">海盐硬糖系列</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="">
                                家居
                            </a>
                            <div class="inner_nav_bg">
                                <ul class="inner_nav">
                                    <li><a href="">全部</a></li>
                                    <li><a href="">城市丛林系列</a></li>
                                    <li><a href="">牙白香榭系列</a></li>
                                    <li><a href="">本木侘寂系列</a></li>
                                    <li><a href="">瑞典美术系列</a></li>
                                    <li><a href="">海盐硬糖系列</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <a href="">
                                折扣区
                            </a>
                            <div class="inner_nav_bg">
                                <ul class="inner_nav">
                                    <li><a href="">全部</a></li>
                                    <li><a href="">城市丛林系列</a></li>
                                    <li><a href="">牙白香榭系列</a></li>
                                    <li><a href="">本木侘寂系列</a></li>
                                    <li><a href="">瑞典美术系列</a></li>
                                    <li><a href="">海盐硬糖系列</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                    <ul class="navLogin">
                        <li><i></i><a href="">实体店</a></li>
                        <li><a href="">了解造作新家</a></li>
                        <li><a href="">商业合作</a></li>
                        <li><a href="login.html"><i></i></a></li>
                        <li><a href=""><i></i></a></li>

                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="cart-part-list">
            <div class="container">
                <h3>单品</h3>
                <div class="cart-index">
                    <ul>
                        <li class="ch_box"><input type="checkbox"></li>
                        <li>
                            <img src="./img/g_1.jpg" alt="">
                        </li>
                        <li class="theme">
                            <div>
                                <h4>
                                    半月湾行政沙发
                                </h4>
                                <p>

                                    <span>海灰/</span>
                                    <span>精简版/</span>
                                    <span>转角四人座左扶手/</span>
                                </p>
                            </div>
                        </li>
                        <li class="get_time">
                            <div>
                                预计<em>2022-10-03</em>发货
                            </div>
                        </li>
                        <li class="_price">
                            <div>
                                <span>¥18000</span>
                                <label>¥35997</label>
                            </div>
                        </li>
                        <li class="_count">
                            <div class="_count_inner1">
                                <button>-</button>
                                <input type="text" value="1">
                                <button>+</button>
                            </div>
                        </li>
                        <li class="del">
                            <span>修改</span>
                            <span>删除</span>
                        </li>
                    </ul>

                    <ul>
                        <li class="ch_box"><input type="checkbox"></li>
                        <li>
                            <img src="./img/g_1.jpg" alt="">
                        </li>
                        <li class="theme">
                            <div>
                                <h4>
                                    半月湾行政沙发
                                </h4>
                                <p>

                                    <span>海灰/</span>
                                    <span>精简版/</span>
                                    <span>转角四人座左扶手/</span>
                                </p>
                            </div>
                        </li>
                        <li class="get_time">
                            <div>
                                预计<em>2022-10-03</em>发货
                            </div>
                        </li>
                        <li class="_price">
                            <div>
                                <span>¥18000</span>
                                <label>¥35997</label>
                            </div>
                        </li>
                        <li class="_count">
                            <div class="_count_inner1">
                                <button>-</button>
                                <input type="text" value="1">
                                <button>+</button>
                            </div>
                        </li>
                        <li class="del">
                            <span>修改</span>
                            <span>删除</span>
                        </li>
                    </ul>
                    <ul>
                        <li class="ch_box"><input type="checkbox"></li>
                        <li>
                            <img src="./img/g_1.jpg" alt="">
                        </li>
                        <li class="theme">
                            <div>
                                <h4>
                                    半月湾行政沙发
                                </h4>
                                <p>

                                    <span>海灰/</span>
                                    <span>精简版/</span>
                                    <span>转角四人座左扶手/</span>
                                </p>
                            </div>
                        </li>
                        <li class="get_time">
                            <div>
                                预计<em>2022-10-03</em>发货
                            </div>
                        </li>
                        <li class="_price">
                            <div>
                                <span>¥18000</span>
                                <label>¥35997</label>
                            </div>
                        </li>
                        <li class="_count">
                            <div class="_count_inner1">
                                <button>-</button>
                                <input type="text" value="1">
                                <button>+</button>
                            </div>
                        </li>
                        <li class="del">
                            <span>修改</span>
                            <span>删除</span>
                        </li>
                    </ul>
                </div>

            </div>

        </div>
        <div class="total">
            <div class="total_container">
                <ul class="prev">
                    <li class="all"><input type="checkbox"></li>
                    <li><span>全选</span>
                        <span>已选<i class="_count">0</i>件</span>
                    </li>
                </ul>
                <ul class="back">
                    <li><span><label>商品合计：</label><i class="real_price">¥3200</i></span>
                        <span><label>已选优惠：</label><i class="real_price2">¥3200</i></span>
                    </li>
                    <li><span>实付：<i class="shifu">¥3200</i></span>
                        <span>以满足包邮条件</span>
                    </li>
                    <li>
                        <button>立即下单</button>
                    </li>
                </ul>
            </div>

        </div>
        <script>

            var nextId = localStorage.nextId || 0;

            function updateInfo() {
                //更新数据
                localStorage.taskList = JSON.stringify(ary);
                //更新nextId
                localStorage.nextId = nextId;
            }

            //获取数据
            var ary;
            function getInfo() {
                // 考虑第一次没有，需要定义空数组
                //从localstroge中取出
                return localStorage.taskList == undefined ? [] : JSON.parse(localStorage.taskList);
            }

            console.log(getInfo())
            var _cartIndex = document.querySelector(".cart-index");
            console.log(_cartIndex)
            function show() {
                ary = getInfo();
                for (var item of ary) {
                    var _ul = document.createElement("ul");
                    _ul.innerHTML = `
         <li class="ch_box" name="${item.nextId}"><input type="checkbox"></li>
            <li>
                <img src="${item.imgSrc}" alt="">
            </li>
            <li class="theme">
                <div>
                    <h4>
                        半月湾行政沙发
                    </h4>
                    <p>

                        <span>海灰/</span>
                        <span>精简版/</span>
                        <span>转角四人座左扶手/</span>
                    </p>
                </div>
            </li>
            <li class="get_time">
                <div>
                    预计<em>2022-10-03</em>发货
                </div>
            </li>
            <li class="_price">
                <div>
                    <span>¥${item.price1}</span>
                    <label>¥${item.price2}</label>
                </div>
            </li>
            <li class="_count">
                <div class="_count_inner1">
                    <button>-</button>
                    <input type="text" value="1">
                    <button>+</button>
                </div>
            </li>
            <li class="del">
                <span>修改</span>
                <span>删除</span>
            </li>
        `
                }
                _cartIndex.appendChild(_ul);
                _inputs = document.querySelectorAll(".cart-index input[type=checkbox]");
                // updateInfo();
            }
            show();
            /**************************/
            _cartIndex.onclick = function (event) {
                var target = event.srcElement || event.target;


                ary = getInfo();
                console.log(nextId);

                // var nextId;
                if (target.nodeName == "SPAN") {

                    var index = ary.findIndex(function (item) {
                        return item.nextId == nextId;
                    })
                    ary.splice(index, 1);
                    console.log(target.parentNode.parentNode)
                    target.parentNode.parentNode.remove();
                    updateInfo();
                    show();
                }
            }

            /***********************/
            /*结算部分定位*/
            var _total = document.querySelector(".total");
            var _cart_part = document.querySelector(".cart-part-list")
            _total.style.marginTop = window.innerHeight - _total.clientHeight - _cart_part.clientHeight + "px";
            window.onscroll = function () {
                var _top = window.pageYOffset - _total.clientHeight;
                _total.style.marginTop = window.innerHeight - _total.clientHeight - _cart_part.clientHeight + window.pageYOffset + "px";
                if (window.pageYOffset >= 30) {
                    _total.style.marginTop = 30 + "px"
                    return
                }
            }
            /*全选反选效果的实现*/
            var _prev = document.querySelector(".prev");
            var _inputs = document.querySelectorAll(".cart-index input[type=checkbox]");
            console.log(_inputs)
            var _inp = _prev.firstElementChild.firstElementChild;
            var _i = document.querySelector(".prev i")


            _inp.onclick = function () {
                var status = _inp.checked;
                if (status == false) {
                    _i.innerHTML = 0;
                } else {
                    _i.innerHTML = _inputs.length;
                }
                // console.log(status);
                _inputs.forEach(function (tag) {
                    tag.checked = status;
                })
                sum();
                Btn();
            }
            _inputs.forEach(function (tag) {
                tag.onclick = function () {

                    var array = Array.from(_inputs).filter(function (item) {
                        return item.checked == true;
                    })
                    console.log(array);
                    _i.innerHTML = array.length;
                    if (array.length == _inputs.length) {
                        _inp.checked = true;
                    } else {
                        _inp.checked = false;
                    }
                    sum();
                    Btn();
                    // show();

                    _inputs = document.querySelectorAll(".cart-index input[type=checkbox]");

                }
            })
            /*商品加减按钮的实现*/
            var _count_inner1 = document.querySelectorAll("._count_inner1");
            var _ul = document.querySelectorAll(".count_inner1 ul");
            _count_inner1.forEach(function (tag) {
                var cols = tag.firstElementChild;
                var add = tag.lastElementChild;
                var inp = tag.children[1];
                var num = inp.value * 1;


                cols.onclick = function () {
                    num -= 1;
                    inp.value = num;

                    if (num <= 0) {
                        this.disabled = true;
                    }
                    sum();
                    Btn();
                }
                add.onclick = function () {
                    cols.disabled = false;
                    num += 1;
                    inp.value = num
                    sum();
                    Btn();
                }
            })
            /*商品总价*/
            var _sumPrice = document.querySelector(".back .shifu");
            var _sumPrice2 = document.querySelector(".back .real_price");
            var _yh = document.querySelector(".back .real_price2");


            console.log(_sumPrice.innerText)
            function sum() {
                var sum = 0;
                var sum2 = 0;
                var _price = document.querySelectorAll("._price");
                // console.log(_price.parentNode)
                var a = Array.from(_price).filter(function (item) {
                    return item.parentNode.firstElementChild.firstElementChild.checked == true;
                })
                // console.log(a)

                Array.from(a).forEach(function (tag) {
                    var tal = tag.firstElementChild.firstElementChild.innerText;
                    var tal2 = tag.firstElementChild.lastElementChild.innerText;
                    var _inp = tag.nextElementSibling.children[0].children[1].value;
                    // console.log(_inp);
                    console.log(tag.parentNode.firstElementChild.firstElementChild.checked)

                    tal = tal.slice(1) * _inp;
                    tal2 = tal2.slice(1) * _inp;
                    // console.log(tal);
                    sum += tal;
                    sum2 += tal2
                    console.log(sum);
                })
                _sumPrice.innerText = `¥${sum}`;
                _sumPrice2.innerText = `¥${sum2}`;
                _yh.innerText = `¥${sum2 - sum}`
            }
            sum();
            /*删除商品*/
            var _del = document.querySelectorAll(".del");
            _del.forEach(function (tag) {
                tag.lastElementChild.onclick = function () {
                    if (confirm("确认删除吗？"))
                        tag.parentElement.remove();
                    sum();
                    _inputs = document.querySelectorAll(".cart-index input[type=checkbox]");
                    show();

                }

            })
            var _btn_xd = document.querySelector(".back button");
            console.log(_btn_xd)

            function Btn() {
                var _tar = _sumPrice.innerText.slice(1);
                console.log(_tar);
                if (_tar <= 0) {
                    _btn_xd.disabled = true;
                    _btn_xd.style.backgroundColor = "#d2d2d2"
                } else {
                    _btn_xd.disabled = false;
                    _btn_xd.style.backgroundColor = "black"
                }
            }
            Btn();
            /************************************/


        </script>
    </main>
    <footer>
        <div class="newFooter">
            <div class="container">
                <div class="_left">
                    <img src="./img/foot_1.png" alt="">
                    <div class="tb">
                        <i class="fa fa-weixin weixin " aria-hidden="true"></i>
                        <i class="fa fa-weibo weixin" aria-hidden="true"></i>
                    </div>

                </div>
                <div class="_center">
                    <div class="foot_nav">
                        <ul>
                            <li><a href="">关于造作新家</a></li>
                            <li><a href="">团队介绍</a></li>

                            <li><a href="">设计师团</a></li>

                            <li><a href="">媒体报道</a></li>
                            <li><a href="">加入造作新家</a></li>
                            <li><a href="">Designer Hiring</a></li>

                        </ul>
                        <ul>
                            <li><a href="">关于造作新家</a></li>
                            <li><a href="">团队介绍</a></li>

                            <li><a href="">设计师团</a></li>

                            <li><a href="">媒体报道</a></li>
                            <li><a href="">加入造作新家</a></li>
                            <li><a href="">Designer Hiring</a></li>

                        </ul>
                        <ul>
                            <li><a href="">关于造作新家</a></li>
                            <li><a href="">团队介绍</a></li>
                            <li><a href="">设计师团</a></li>
                            <li><a href="">媒体报道</a></li>
                            <li><a href="">加入造作新家</a></li>
                            <li><a href="">Designer Hiring</a></li>

                        </ul>
                    </div>
                </div>
                <div class="_right">
                    <div class="call_we">
                        <p><a href="">联系我们</a></p>
                        <p>400-6636-926 <span>（9:00~21:00）</span>
                        </p>
                        <div class="sever_online">
                            <span>在线客服</span>
                        </div>
                        <div class="shop_entry">
                            造作新家全国实体店<i class="fa fa-angle-right fa-2x" aria-hidden="true"></i>
                        </div>

                    </div>
                </div>
            </div>
            <div class="copyright">
                <div class="content">
                    <p>
                        Copyright © 2018 zaozuo.com Inc.All Rights Reserved. 北京造化科技有限公司
                    </p>
                    <p>
                        版权所有<a href="">京ICP备14049641号-1</a><a href="">增值电信业务经营许可证：京ICP证150098号</a>
                    </p>
                    <p><a href="">造作新家</a>官网-全球设计师创作<a href="">家居品牌</a></p>
                    <p><a href="">营业执照</a></p>
                </div>
            </div>
        </div>

    </footer>
    <!-- <script class="./js/shopping.js"></script> -->
</body>

</html>